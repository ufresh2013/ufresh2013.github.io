
<!DOCTYPE html>
<html lang="">


  <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#202020">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    
        <meta name="keywords" content="">
        

          
              <meta name="description" content="Webpack基本用法">
              

                <link rel="icon" type="image/x-icon" href="data:image/png;base64,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">
                <title>
                  Webpack基本用法 [ 日常笔记 ]
                </title>
                
                  <!-- stylesheets list from config.yml -->
                  
                    <link rel="stylesheet" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css">
                    
                    <link rel="stylesheet" href="/css/microb.css">
                    
                      
  </head>

<body>
  <div class="container" id="content-outer">
    <div class="inner" id="content-inner">
        <div class="tab">
            <a href="/"><img src="/left.png" /></a>
            <span><a href="/">日常笔记</a></span>
            <!-- <span><a class="tab-search" href="/search/">搜索</a></span> -->
            
              <span><a class="tab-title" id="#Basic" href="/#Basic">Basic</a></span>
            
              <span><a class="tab-title" id="#Browser" href="/#Browser">Browser</a></span>
            
              <span><a class="tab-title" id="#CSS" href="/#CSS">CSS</a></span>
            
              <span><a class="tab-title" id="#Debug" href="/#Debug">Debug</a></span>
            
              <span><a class="tab-title" id="#HTML" href="/#HTML">HTML</a></span>
            
              <span><a class="tab-title" id="#JS" href="/#JS">JS</a></span>
            
              <span><a class="tab-title" id="#NodeJS" href="/#NodeJS">NodeJS</a></span>
            
              <span><a class="tab-title" id="#React" href="/#React">React</a></span>
            
              <span><a class="tab-title" id="#Vue" href="/#Vue">Vue</a></span>
            
              <span><a class="tab-title" id="#其他" href="/#其他">其他</a></span>
            
          </div>
      
  <div id="toc" class="toc-article">
    <!--<strong class="toc-title">目录</strong>-->
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-基本概念"><span class="toc-text">1. 基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-安装运行"><span class="toc-text">1.1 安装运行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-基本组成"><span class="toc-text">1.2 基本组成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-简写路径，新增模块目录"><span class="toc-text">1.3 简写路径，新增模块目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-optimization"><span class="toc-text">1.4 optimization</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-loader-plugin"><span class="toc-text">2. loader + plugin</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-解析ES6、JSX"><span class="toc-text">2.1 解析ES6、JSX</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-解析CSS"><span class="toc-text">2.2 解析CSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-解析图片字体"><span class="toc-text">2.3 解析图片字体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-热更新"><span class="toc-text">2.4 热更新</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-文件压缩"><span class="toc-text">2.6 文件压缩</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-7-资源内联"><span class="toc-text">2.7 资源内联</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-8-暴露全局变量"><span class="toc-text">2.8 暴露全局变量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-优化生产配置"><span class="toc-text">3. 优化生产配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-Tree-Shaking"><span class="toc-text">3.1 Tree-Shaking</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-Scope-Hoisting"><span class="toc-text">3.2 Scope Hoisting</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-提取公用资源"><span class="toc-text">3.1 提取公用资源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-代码分离"><span class="toc-text">3.4 代码分离</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-加快打包速度"><span class="toc-text">4. 加快打包速度</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-缓存加快二次构建"><span class="toc-text">4.1 缓存加快二次构建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-缩小构建目标"><span class="toc-text">4.2 缩小构建目标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-分包：预编译资源"><span class="toc-text">4.3 分包：预编译资源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-多进程并行压缩"><span class="toc-text">4.4 多进程并行压缩</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-优化显示日志"><span class="toc-text">4.5 优化显示日志</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-其他"><span class="toc-text">5. 其他</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-eslintrc"><span class="toc-text">5.1 .eslintrc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-babelrc"><span class="toc-text">5.2 .babelrc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-其他"><span class="toc-text">5.3 其他</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考资料"><span class="toc-text">参考资料</span></a></li></ol>
  </div>


<div class="section">
  <article class="post" id="post">
    <header class="post-header text-center">
      <h1 class="title">
        Webpack基本用法
      </h1>
      
      <time class="time" datetime="2018-11-14T07:47:27.000Z">
        2018-11-14
      </time>
      
      <hr>
    </header>
    <div class="post-content">
      <blockquote>
<p>为什么需要 Webpack 构建工具？</p>
<ol>
<li>多终端应用场景，需要不同的打包配置。如：PC 单页面打包，H5 支持服务端渲染和 PWA 离线缓存</li>
<li>npm 是 JS 的包管理系统，但 npm 包不能在 js 中直接引用</li>
<li>React, Vue, AngularJS, less, CssModules 语法在浏览器中无法直接解析</li>
</ol>
</blockquote>
<p><br></p>
<h3 id="1-基本概念"><a href="#1-基本概念" class="headerlink" title="1. 基本概念"></a>1. 基本概念</h3><h4 id="1-1-安装运行"><a href="#1-1-安装运行" class="headerlink" title="1.1 安装运行"></a>1.1 安装运行</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack webpack-cli --save-dev</span><br><span class="line">./node_modules/.bin/webpack -v</span><br></pre></td></tr></table></figure>
<p>通过 npm script 运行 webpack。模块局部安装会在 node_modules/.bin 目录创建软连接</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scripts: &#123; <span class="string">"build"</span>: <span class="string">"webpack --config prod.config.js"</span> &#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="1-2-基本组成"><a href="#1-2-基本组成" class="headerlink" title="1.2 基本组成"></a>1.2 基本组成</h4><ul>
<li><p>配置文件<br>默认配置是 webpack.config.js， 可以通过<code>webpack --config</code>指定配置文件</p>
</li>
<li><p>entry<br>通过入口文件寻找依赖，单入口 entry 是一个字符串，多入口 entry 是一个对象</p>
</li>
<li><p>output<br>指示webpack如何输出、以及在哪里输出你的bundle, asset和其他使用webpack载入的内容。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">  filename: <span class="string">'[name].[hash].bundle.js'</span>  <span class="comment">// 决定每个输出bundle的名称</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>[hash]</code>: 和整个项目的构建有关，只要项目文件有修改，整个项目构建的 hash 值就会更改<br><code>[chunkhash]</code>: 和 webpack 打包的 chunk 有关，不同的 entry 会生成不同的 chunkhash 值<br><code>[contenthash]</code>: 根据文件内容来定义 hash， 文件内容不变，则 contenthash 不变</p>
<p><code>[ext]</code> 资源后缀名<br><code>[name]</code> 文件名称<br><code>[path]</code> 文件的相对路径<br><code>[folder]</code> 文件所在的文件夹</p>
</li>
<li><p>context<br>基础目录，绝对路径，用于从配置中解析入口起点</p>
</li>
<li><p>mode<br>指定当前构造环境的值是production | development | none。 或者用<code>webpack --mode=production</code>传递。默认值为 production，指定后会设置<code>process.end.NODE_ENV</code>为该值，并默认开启一些插件。</p>
</li>
<li><p>loader<br>webpack 开箱即用只支持 js 和 json 两种文件类型，通过 loaders 去支持其他文件类型并且把它们转换成有效的模块，并且可以添加到依赖图中。loader 本身是一个函数，接受源文件作为参数，返回转换的结果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test 指定匹配规则</span><br><span class="line">use 指定loader名称</span><br><span class="line">options 可选项</span><br><span class="line">include, exclude, oneOf 指定文件范围</span><br></pre></td></tr></table></figure>
</li>
<li><p>plugin<br>插件用于 bundle 文件的优化，资源管理和环境变量注入，作用于整个构建过程</p>
</li>
<li><p>devtool<br>选择一种source map源映射方式，方便调试。</p>
</li>
<li><p>devServer<br>配置代理</p>
</li>
<li><p>server<br>配置webserver</p>
</li>
</ul>
<p><br></p>
<h4 id="1-3-简写路径，新增模块目录"><a href="#1-3-简写路径，新增模块目录" class="headerlink" title="1.3 简写路径，新增模块目录"></a>1.3 简写路径，新增模块目录</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">  <span class="comment">// 配置简写路径</span></span><br><span class="line">  alias: &#123;</span><br><span class="line">    <span class="string">'@'</span>: path.join(__dirname, <span class="string">'..'</span>, <span class="string">'src'</span>)</span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="comment">// 增加一个模块搜索目录，此目录优先于 node_modules/</span></span><br><span class="line">  modules: [path.resolve(__dirname, <span class="string">'src'</span>), <span class="string">'node_modules'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="1-4-optimization"><a href="#1-4-optimization" class="headerlink" title="1.4 optimization"></a>1.4 optimization</h4><p>webpack4开始，不同的mode会执行不同的优化，production与development的区别如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">  minimize: <span class="literal">true</span>,       <span class="comment">// 使用TerserPlugin压缩bundle</span></span><br><span class="line">  nameModules: <span class="literal">false</span>,   <span class="comment">// 使用可读取模块标识符，帮助更好滴调试</span></span><br><span class="line">  nameChunks: <span class="literal">false</span>,    <span class="comment">// 使用可读取chunk标识符</span></span><br><span class="line">  nodeEnv: <span class="string">'production'</span>,<span class="comment">// 将process.env.NODE_ENV设置为一个给定字符串</span></span><br><span class="line">  flagIncludedChunks: <span class="literal">false</span>,  <span class="comment">// 已经加载过较大的chunk之后，就不再去加载这些chunk子集</span></span><br><span class="line">  occurenceOrder: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>常见的环境配置差异</p>
<ul>
<li>生产环境可能需要分离 CSS 成单独的文件，以便多个页面共享同一个 CSS 文件</li>
<li>生产环境需要压缩 HTML/CSS/JS 代码</li>
<li>生产环境需要压缩图片</li>
<li>开发环境需要生成 sourcemap 文件</li>
<li>开发环境需要打印 debug 信息</li>
<li>开发环境需要 live reload 或者 hot reload 的功能</li>
</ul>
<p><br></p>
<h3 id="2-loader-plugin"><a href="#2-loader-plugin" class="headerlink" title="2. loader + plugin"></a>2. loader + plugin</h3><h4 id="2-1-解析ES6、JSX"><a href="#2-1-解析ES6、JSX" class="headerlink" title="2.1 解析ES6、JSX"></a>2.1 解析ES6、JSX</h4><p><code>babel-loader</code>用于解析ES6, JSX语法, babel的配置文件是<code>.bablerc</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// npm i @babel/core @babel/preset-env babel-loader -D</span></span><br><span class="line">&#123; <span class="attr">text</span>: <span class="regexp">/\.js$/</span>, <span class="attr">use</span>: <span class="string">'bable-loader'</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// .babelrc 文件</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"presets"</span>: [</span><br><span class="line"><span class="string">"@babel/preset-env"</span>, <span class="comment">// 解析 es6 语法</span></span><br><span class="line"><span class="string">"@babel/preset-react"</span> <span class="comment">// 解析 React JSX</span></span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="2-2-解析CSS"><a href="#2-2-解析CSS" class="headerlink" title="2.2 解析CSS"></a>2.2 解析CSS</h4><p><code>css-loader</code>用于加载.css文件，并且转换成commonjs对象<br><code>style-loader</code>将样式通过<code>&lt;style&gt;</code>标签插入到head中<br><code>less-loader</code>将less转换成css<br><code>postcss-loader</code> CSS前缀自动补全, 支持cssModules<br><code>px2rem</code> px自动转换为rem</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loader的执行是链式调用，执行顺序是从右到左。</span></span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/.(css|less)$/</span>,</span><br><span class="line">  use: [</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'style-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        insertAt: <span class="string">'top'</span>, <span class="comment">// 样式插入到&lt;head&gt;</span></span><br><span class="line">        singleton: <span class="literal">true</span>, <span class="comment">// 将所有的style标签合并成一个</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'css-loader'</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        plugins: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>)(&#123;</span><br><span class="line">            browser: [<span class="string">'last 2 version'</span>, <span class="string">'&gt;1%'</span>, <span class="string">'ios 7'</span>]</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'less-loader'</span>,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>MiniCssExtractPlugin</code> 将样式提取到一个公共文件，注意它和 less-loader 的功能是互斥的，此时要去掉 less-loader。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将样式提取到公用文件</span></span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/.(css|less)$/</span>,</span><br><span class="line">  use: [</span><br><span class="line">    MiniCssExtractPlugin.loader,</span><br><span class="line">    <span class="string">'css-loader'</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">plugins: [</span><br><span class="line">  <span class="comment">// css文件压缩</span></span><br><span class="line">  <span class="keyword">new</span> OptimizeCSSAssetsPlugin(&#123;</span><br><span class="line">    assetNameRegExp: <span class="regexp">/.css$/g</span>,</span><br><span class="line">    cssProcessor: <span class="built_in">require</span>(<span class="string">'cssnano'</span>)</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">    filename: <span class="string">'[name]_[contenthash:8].css'</span></span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="2-3-解析图片字体"><a href="#2-3-解析图片字体" class="headerlink" title="2.3 解析图片字体"></a>2.3 解析图片字体</h4><p><code>file-loader</code>用于处理文件。<code>url-loader</code>可以将较小资源转换为base64<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/.(png|jpg|jpeg)$/</span>,</span><br><span class="line">  use: [&#123;</span><br><span class="line">    loader: <span class="string">'url-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      limit: <span class="number">10240</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/.(woff|woff2|ttf|eot|otf)$/</span>,</span><br><span class="line">  use: [&#123;</span><br><span class="line">    loader: <span class="string">'file-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      name: <span class="string">'assets/[name][hash:8].[ext]'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="2-4-热更新"><a href="#2-4-热更新" class="headerlink" title="2.4 热更新"></a>2.4 热更新</h4><p>文件监听是在发现源码变化时，自动重新构造出新的输出文件。webpack中开启监听模式，有两种方式</p>
<ul>
<li><code>webpack --watch</code></li>
<li>webpack.config.js中设置<code>watch: true</code></li>
</ul>
<p>虽然 webpack 会自动构建，但是浏览器不会自动更新</p>
<ul>
<li>webpack-dev-server，localhost 可访问页面</li>
<li>HotModuleReplacementPlugin 插件，不用手动刷新浏览器</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// npm install webpack-dev-server -D</span></span><br><span class="line"><span class="comment">// &#123; scripts: &#123; "dev": "webpack-dev-server --open" &#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">],</span><br><span class="line">devServer: &#123;</span><br><span class="line">  contentBase: <span class="string">'./dist'</span>,</span><br><span class="line">  hot: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h4 id="2-6-文件压缩"><a href="#2-6-文件压缩" class="headerlink" title="2.6 文件压缩"></a>2.6 文件压缩</h4><p><code>optimize-css-assets-webpack-plugin</code> CSS压缩<br><code>uglifyjs-webpack-plugin</code> JS压缩<br><code>html-webpack-plugin</code> HTML压缩</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">    template: path.join(__dirname, <span class="string">'src/search.html'</span>), <span class="comment">// 指定模板</span></span><br><span class="line">    filename: <span class="string">'search.html'</span>, <span class="comment">// 打包出来的文件名</span></span><br><span class="line">    chunks: [<span class="string">'search'</span>], <span class="comment">// 使用了哪些entry chunk</span></span><br><span class="line">    inject: <span class="literal">true</span>, <span class="comment">// js, css自动注入到html</span></span><br><span class="line">    minify: &#123;</span><br><span class="line">      html5: <span class="literal">true</span>,</span><br><span class="line">      collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">      preserveLineBreads: <span class="literal">false</span>,</span><br><span class="line">      minifyCSS: <span class="literal">true</span>,</span><br><span class="line">      minifyJS: <span class="literal">true</span>,</span><br><span class="line">      removeComments: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="2-7-资源内联"><a href="#2-7-资源内联" class="headerlink" title="2.7 资源内联"></a>2.7 资源内联</h4><p><code>raw-loader</code>内联HTML, JS。内联CSS，用style-loader / html-inline-css-webpack-plugin<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">$&#123;<span class="built_in">require</span>(<span class="string">'raw-loader!babel-loader!./meta.html'</span>)&#125;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">$&#123;<span class="built_in">require</span>(<span class="string">'raw-loader!../node-modules/lib-flexible.js'</span>)&#125;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="2-8-暴露全局变量"><a href="#2-8-暴露全局变量" class="headerlink" title="2.8 暴露全局变量"></a>2.8 暴露全局变量</h4><p><br></p>
<h3 id="3-优化生产配置"><a href="#3-优化生产配置" class="headerlink" title="3. 优化生产配置"></a>3. 优化生产配置</h3><h4 id="3-1-Tree-Shaking"><a href="#3-1-Tree-Shaking" class="headerlink" title="3.1 Tree-Shaking"></a>3.1 Tree-Shaking</h4><p>一个模块可能有多个方法，只要其中的某个方法使用到了，则整个文件都会被打到bundle里，tree-shaking只把用到的方法打入bundle，没用到的方法会在uglify阶段被擦除。要求必须是ES6的语法</p>
<p>Webpack默认支持开启tree-shaking，设置<em><code>mode: &#39;production&#39;</code></em>即可。或在.babelrc里设置<em><code>modules: false</code></em>即可。</p>
<p><br></p>
<h4 id="3-2-Scope-Hoisting"><a href="#3-2-Scope-Hoisting" class="headerlink" title="3.2 Scope Hoisting"></a>3.2 Scope Hoisting</h4><p>构造后的代码存在大量函数闭包包裹代码，导致体积增大（模块越多越明显）。运行代码时创建的函数作用于变多，内存开销变大。<em><code>Scope Hositing</code></em>译为作用域提升。它将所有模块的代码按照引用顺序放在一个函数作用域里，然后适当的重命名一些变量以防止变量名冲突。从而减少函数声明代码和内存开销。</p>
<p>Webpack4设置<em><code>mode: production</code></em>，会默认开启scope hoisting。<br>Webpack3中需要增加<em><code>new webpack.optimize.MouduleConcatenationPlugin()</code></em>。</p>
<p><br></p>
<h4 id="3-1-提取公用资源"><a href="#3-1-提取公用资源" class="headerlink" title="3.1 提取公用资源"></a>3.1 提取公用资源</h4><p>提取公共资源<br>CommonSplitChunk</p>
<p><br></p>
<h4 id="3-4-代码分离"><a href="#3-4-代码分离" class="headerlink" title="3.4 代码分离"></a>3.4 代码分离</h4><p>把代码分离到不同的bundle中，可以按需加载或并行加载这些文件。常用的代码分离有三种：</p>
<ul>
<li>入口起点： 使用<code>entry</code>配置手动地分离代码</li>
<li>防止重复： 使用<code>SplitChunksPlugin</code>分离chunk</li>
<li>动态导入： 通过模块中的内联函数调用来分离代码<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">'./src/index.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span>,</span><br><span class="line">    chunkFilename: <span class="string">'[name].bundle.js'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在React中根据路由做代码分割<br>src/index.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncComponent <span class="keyword">from</span> <span class="string">'./async-component'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取到异步组件</span></span><br><span class="line"><span class="keyword">const</span> AsyncDemo = asyncComponent(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./demo'</span>))</span><br><span class="line"></span><br><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Route path=<span class="string">"/demo"</span> component=&#123;AsyncDemo&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>src/async-component.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @param &#123;Function&#125; loadComponent e.g: () =&gt; import('./component')</span></span><br><span class="line"><span class="comment"> * @param &#123;ReactNode&#125; placeholder  未加载前的占位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (loadComponent, placeholder = <span class="literal">null</span>) =&gt; &#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">AsyncComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    unmount = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">      <span class="keyword">super</span>()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.state = &#123;</span><br><span class="line">        component: <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">      <span class="keyword">this</span>.unmount = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> componentDidMount() &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;<span class="attr">default</span>: component&#125; = <span class="keyword">await</span> loadComponent()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">this</span>.unmount) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        component: component</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">const</span> C = <span class="keyword">this</span>.state.component</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        C ? <span class="xml"><span class="tag">&lt;<span class="name">C</span> &#123;<span class="attr">...this.props</span>&#125;&gt;</span><span class="tag">&lt;/<span class="name">C</span>&gt;</span></span> : placeholder</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> AsyncComponent</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="4-加快打包速度"><a href="#4-加快打包速度" class="headerlink" title="4. 加快打包速度"></a>4. 加快打包速度</h3><h4 id="4-1-缓存加快二次构建"><a href="#4-1-缓存加快二次构建" class="headerlink" title="4.1 缓存加快二次构建"></a>4.1 缓存加快二次构建</h4><h4 id="4-2-缩小构建目标"><a href="#4-2-缩小构建目标" class="headerlink" title="4.2 缩小构建目标"></a>4.2 缩小构建目标</h4><p>缩小loader应用范围，限定只在 src 目录下的 js/jsx 文件需要经 babel-loader 处理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rules: [ </span><br><span class="line">  &#123;</span><br><span class="line">    test: /\.jsx?/,</span><br><span class="line">    include: [ </span><br><span class="line">        path.resolve(__dirname, &apos;src&apos;), </span><br><span class="line">    ],</span><br><span class="line">    use: &apos;babel-loader&apos;,</span><br><span class="line">  &#125;,</span><br><span class="line">  // ...</span><br><span class="line">],</span><br></pre></td></tr></table></figure></p>
<h4 id="4-3-分包：预编译资源"><a href="#4-3-分包：预编译资源" class="headerlink" title="4.3 分包：预编译资源"></a>4.3 分包：预编译资源</h4><h4 id="4-4-多进程并行压缩"><a href="#4-4-多进程并行压缩" class="headerlink" title="4.4 多进程并行压缩"></a>4.4 多进程并行压缩</h4><h4 id="4-5-优化显示日志"><a href="#4-5-优化显示日志" class="headerlink" title="4.5 优化显示日志"></a>4.5 优化显示日志</h4><p><br></p>
<h3 id="5-其他"><a href="#5-其他" class="headerlink" title="5. 其他"></a>5. 其他</h3><h4 id="5-1-eslintrc"><a href="#5-1-eslintrc" class="headerlink" title="5.1 .eslintrc"></a>5.1 .eslintrc</h4><h4 id="5-2-babelrc"><a href="#5-2-babelrc" class="headerlink" title="5.2 .babelrc"></a>5.2 .babelrc</h4><h4 id="5-3-其他"><a href="#5-3-其他" class="headerlink" title="5.3 其他"></a>5.3 其他</h4><ul>
<li><p><code>clean-webpack-plugin</code><br>自动清理构建目录， 避免每次构建前要手动清除dist</p>
</li>
<li><p>devtool</p>
</li>
</ul>
<ul>
<li>globs<br>多页面打包，当存在多个entry和html时，可以动态获取entry、动态设置html-webpack-plugin。</li>
</ul>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul>
<li><a href="https://webpack.docschina.org/guides/code-splitting/" target="_blank" rel="noopener">代码分离</a></li>
<li><a href="https://www.jianshu.com/p/e3334a2c08e7" target="_blank" rel="noopener">react-router4代码分割</a></li>
</ul>

    </div>
  </article>
    
    <div class="post-nav">
      <div class="post-nav-item post-nav-next">
        
          <span>〈 </span>
          <a href="/2018/11/06/CSS-example/" rel="next" title="CSS常用实例">
          CSS常用实例
          </a>
        
      </div>
  
      <div class="post-nav-item post-nav-prev">
        
          <a href="/2018/11/14/Vue数据绑定/" rel="prev" title="Object.defineProperty实现双向绑定">
            Object.defineProperty实现双向绑定
          </a>
          <span>〉</span>
        
      </div>
    </div>
  
</div>


<script>
var link = document.getElementsByClassName('toc-link');
var hash = decodeURIComponent(location.hash);
if (hash){
} else {
  link[0].classList.add('toc-link-active');
}

var h3 = document.getElementsByTagName('h3');
var h4 = document.getElementsByTagName('h4');
var h5 = document.getElementsByTagName('h5');
var link_arr = [];
function addToArr(arr){
  for(var i = 0; i < arr.length; i++){
    link_arr.push(arr[i].offsetTop);
  }
}
addToArr(h3);
addToArr(h4);
addToArr(h5);


var compare = function (x, y) {
    if (x < y) {
        return -1;
    } else if (x > y) {
        return 1;
    } else {
        return 0;
    }
}

link_arr.sort(compare);


window.onscroll = function(){
  var height = document.documentElement.scrollTop;
  for (var i = 0; i < link_arr.length; i++){
    if (link_arr[i] > height){
      for(var j = 0; j < link.length; j++){
        link[j].classList.remove('toc-link-active');
      }
      document.getElementsByClassName('toc-link')[i].classList.add('toc-link-active');
      break;
    } 
  }
}

</script>
    </div>
  </div>
  




    <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js"></script>
    
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // listen to any DOM change and automatically perform spacing via MutationObserver()
        pangu.autoSpacingPage();
      });
    </script>
</body>
</html>

