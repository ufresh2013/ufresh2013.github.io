
<!DOCTYPE html>
<html lang="">


  <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#202020">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    
        <meta name="keywords" content="">
        

          
              <meta name="description" content="ğŸ¤” Jestè¿è¡Œå‰ç«¯å•å…ƒæµ‹è¯•">
              

                <link rel="icon" type="image/x-icon" href="data:image/png;base64,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">
                <title>
                  ğŸ¤” Jestè¿è¡Œå‰ç«¯å•å…ƒæµ‹è¯• [ å¼€å‘ç¬”è®° ]
                </title>
                
                  <!-- stylesheets list from config.yml -->
                  
                    <link rel="stylesheet" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css">
                    
                    <link rel="stylesheet" href="/css/microb.css">
                    
                      
  </head>

<body>
  <div class="container" id="content-outer">
    <div class="inner" id="content-inner">
        <div class="tab">
            <a href="/"><img src="/left.png" /></a>
            <span><a href="/">å¼€å‘ç¬”è®°</a></span>
            <!-- <span><a class="tab-search" href="/search/">æœç´¢</a></span> -->
            
              <span><a class="tab-title" id="#Basic" href="/#Basic">Basic</a></span>
            
              <span><a class="tab-title" id="#Browser" href="/#Browser">Browser</a></span>
            
              <span><a class="tab-title" id="#Bug" href="/#Bug">Bug</a></span>
            
              <span><a class="tab-title" id="#CSS" href="/#CSS">CSS</a></span>
            
              <span><a class="tab-title" id="#HTML" href="/#HTML">HTML</a></span>
            
              <span><a class="tab-title" id="#HTTP" href="/#HTTP">HTTP</a></span>
            
              <span><a class="tab-title" id="#JS" href="/#JS">JS</a></span>
            
              <span><a class="tab-title" id="#LeetCode" href="/#LeetCode">LeetCode</a></span>
            
              <span><a class="tab-title" id="#NodeJS" href="/#NodeJS">NodeJS</a></span>
            
              <span><a class="tab-title" id="#React" href="/#React">React</a></span>
            
              <span><a class="tab-title" id="#Vue" href="/#Vue">Vue</a></span>
            
              <span><a class="tab-title" id="#Work" href="/#Work">Work</a></span>
            
              <span><a class="tab-title" id="#å…¨æ ˆ" href="/#å…¨æ ˆ">å…¨æ ˆ</a></span>
            
              <span><a class="tab-title" id="#åŠ¨ç”»/åª’ä½“" href="/#åŠ¨ç”»/åª’ä½“">åŠ¨ç”»/åª’ä½“</a></span>
            
          </div>
      
  <div id="toc" class="toc-article">
    <!--<strong class="toc-title">ç›®å½•</strong>-->
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Jestç®€ä»‹"><span class="toc-text">1. Jestç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-å®ç°Jest"><span class="toc-text">2.å®ç°Jest</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-å®ç°Expect"><span class="toc-text">3.å®ç°Expect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-ç»„ä»¶æµ‹è¯•-Vue-Util-Test"><span class="toc-text">4.ç»„ä»¶æµ‹è¯•: Vue Util Test</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-ç¼–å†™æµ‹è¯•ç”¨ä¾‹"><span class="toc-text">5.ç¼–å†™æµ‹è¯•ç”¨ä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-å®ç°Mock"><span class="toc-text">6.å®ç°Mock</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-jest-fn"><span class="toc-text">6.1 jest.fn</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-jest-spyOn"><span class="toc-text">6.2 jest.spyOn</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-jest-fn-mockImplementation"><span class="toc-text">6.3 jest.fn.mockImplementation</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-é…ç½®Stub"><span class="toc-text">7. é…ç½®Stub</span></a></li></ol>
  </div>


<div class="section">
  <article class="post" id="post">
    <header class="post-header text-center">
      <h1 class="title">
        ğŸ¤” Jestè¿è¡Œå‰ç«¯å•å…ƒæµ‹è¯•
      </h1>
      
      <time class="time" datetime="2022-04-24T08:17:45.000Z">
        2022-04-24
      </time>
      
      <hr>
    </header>
    <div class="post-content">
      <p>å•å…ƒæµ‹è¯•æ˜¯å¯¹è½¯ä»¶ä¸­çš„æœ€å°å¯æµ‹è¯•å•å…ƒåœ¨ä¸è½¯ä»¶å…¶ä»–éƒ¨åˆ†ç›¸éš”ç¦»çš„æƒ…å†µä¸‹è¿›è¡Œçš„ä»£ç çº§æµ‹è¯•ã€‚è¿™é‡Œçš„æœ€å°å¯æµ‹è¯•å•å…ƒï¼Œé€šå¸¸æŒ‡å‡½æ•°ã€æ¥å£ã€‚å®ƒä»¬æœ‰æ˜ç¡®çš„è¾“å…¥å’Œè¾“å‡ºï¼Œä¸ºäº†ä¿è¯ä»£ç é€»è¾‘æ­£ç¡®ï¼Œæˆ‘ä»¬éœ€è¦åˆ—ä¸¾æ‰€æœ‰è¾“å…¥ï¼Œå¹¶æ£€æŸ¥å®ƒä»¬çš„è¾“å‡ºæ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œæ¥å®Œæˆå•æµ‹ã€‚</p>
<p>é—®é¢˜æ¥äº†ï¼Œå‰ç«¯éƒ½æ˜¯UIç»„ä»¶ï¼Œå¯ä»¥åšå•æµ‹å—ï¼Ÿæ€ä¹ˆæµ‹ï¼Ÿè¦æµ‹ä»€ä¹ˆï¼Ÿ</p>
<p>å…¶å®ä¸ºä¸€ä¸ªå‰ç«¯åº”ç”¨åšå•å…ƒæµ‹è¯•å’Œä¸ºå‡½æ•°ã€æ¥å£åšæµ‹è¯•ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆæ˜æ˜¾çš„åŒºåˆ«ã€‚æƒ³è±¡ä¸€ä¸‹ï¼ŒæŠŠç”¨æˆ·çš„ç‚¹å‡»è¡Œä¸ºä½œä¸ºè¾“å…¥ï¼ŒæŠŠç»„ä»¶æ¸²æŸ“å‡ºæ¥çš„HTMLä½œä¸ºè¾“å‡ºï¼Œä¸å°±å¯ä»¥éªŒè¯ä»£ç çš„æ­£ç¡®æ€§äº†å—ï¼</p>
<p>æ‰€ä»¥ï¼Œå‰ç«¯çš„å•æµ‹ç”¨ä¾‹ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>åŠ è½½ä¸€ä¸ªUIç»„ä»¶</li>
<li>æ£€æŸ¥ç»„ä»¶æ¸²æŸ“å‡ºæ¥çš„HTML æ˜¯å¦ç¬¦åˆé¢„æœŸ</li>
<li>è§¦å‘ç‚¹å‡»äº‹ä»¶</li>
<li>æ£€æŸ¥æ˜¯å¦è°ƒç”¨äº†æ¥å£ï¼Œè°ƒç”¨å‚æ•°æ˜¯å¦æ­£ç¡®</li>
<li>è®¾å®šæ¥å£è¿”å›çš„æ•°æ®</li>
<li>æ¥å£æ•°æ®è¿”å›åï¼Œæ£€æŸ¥ç»„ä»¶æ¸²æŸ“å‡ºæ¥çš„ HTML æ˜¯å¦ç¬¦åˆé¢„æœŸ<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">'@vue/test-utils'</span></span><br><span class="line"><span class="keyword">import</span> api <span class="keyword">from</span> <span class="string">'@src/api.js'</span></span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">'../src/Login.vue'</span></span><br><span class="line"></span><br><span class="line">describe(<span class="string">'ç™»å½•ç»„ä»¶'</span>, () =&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> wrapper = mount(Login)</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'ç‚¹å‡»ç™»é™†æŒ‰é’®'</span>, <span class="keyword">async</span>() =&gt; &#123;</span><br><span class="line">    <span class="comment">// æå‰å®šä¹‰æœåŠ¡ç«¯è¿”å›å†…å®¹</span></span><br><span class="line">    jest</span><br><span class="line">      .spyOn(api, <span class="string">'login'</span>)</span><br><span class="line">      .mockImplementation(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(&#123; <span class="attr">status</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œ</span></span><br><span class="line">    <span class="keyword">await</span> wrapper.find(<span class="string">'.button'</span>).trigger(<span class="string">'click'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥è°ƒç”¨API,è°ƒç”¨å‚æ•°æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">    expect(api.login.mock.calls[<span class="number">0</span>][<span class="number">0</span>]).toEqual(&#123;</span><br><span class="line">      userName: <span class="string">'Mike'</span>,</span><br><span class="line">      passwork: <span class="string">'123456'</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥é¡µé¢æ˜¯å¦æ­£å¸¸æ˜¾ç¤º</span></span><br><span class="line">    expect(wrapper.text()).toBe(<span class="string">'ç™»å½•æˆåŠŸ'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>æœ‰éå¸¸å¤šçš„å·¥å…·å’Œæ¡†æ¶ï¼Œå¯ä»¥è¾…åŠ©æˆ‘ä»¬å®Œæˆä¸Šè¿°çš„å•å…ƒæµ‹è¯•ï¼Œæœ¬æ–‡ä»¥ Jest ä¸ºä¾‹ï¼Œè®²ä¸€ä¸‹å‰ç«¯å•å…ƒæµ‹è¯•å¦‚ä½•ç¼–å†™å’Œæ‰§è¡Œã€‚</p>
<p><br></p>
<h3 id="1-Jestç®€ä»‹"><a href="#1-Jestç®€ä»‹" class="headerlink" title="1. Jestç®€ä»‹"></a>1. Jestç®€ä»‹</h3><p>Jest æ˜¯ Facebook å¼€æºçš„ä¸€å¥—ç”¨æ¥åˆ›å»ºã€æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹çš„ JavaScript æµ‹è¯•åº“ã€‚å®ƒæä¾›ä¸€ä¸ªç‹¬ç«‹çš„ã€å…·æœ‰æµè§ˆå™¨ä¸Šä¸‹æ–‡çš„Nodeè¿›ç¨‹æ¥æ‰§è¡Œå•å…ƒæµ‹è¯•ï¼ŒåŒæ—¶é›†æˆäº†æ–­è¨€ã€Mockã€Stubç­‰ API ç”¨äºç¼–å†™æµ‹è¯•ç”¨ä¾‹ã€‚ä¸ºäº†è¯´æ˜ç™½ Jest æ˜¯ï¼š</p>
<ul>
<li>å¦‚ä½•åŠ è½½UIç»„ä»¶ï¼ˆé¡¹ç›®ä»£ç ï¼‰ï¼Ÿ</li>
<li>å¦‚ä½•è§¦å‘ç”¨æˆ·ç‚¹å‡»è¡Œä¸ºï¼Ÿ</li>
<li>å¦‚ä½•è·å–é¡µé¢HTMLï¼Ÿ</li>
<li>å¦‚ä½•æ£€æŸ¥ä¸€ä¸ªå‡½æ•°æœ‰æ²¡æœ‰è¢«è°ƒç”¨ï¼Œä»¥ä»€ä¹ˆæ ·çš„å‚æ•°è¢«è°ƒç”¨ï¼Ÿ</li>
</ul>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ Jest !</p>
<p><br></p>
<h3 id="2-å®ç°Jest"><a href="#2-å®ç°Jest" class="headerlink" title="2.å®ç°Jest"></a>2.å®ç°Jest</h3><p>å‡è®¾æˆ‘ä»¬è¦è·‘ä¸€æ¡å•æµ‹ç”¨ä¾‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–­è¨€è¯­å¥<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test.spec.jsexpect(<span class="number">2</span>Â +Â <span class="number">2</span>).toBe(<span class="number">4</span>)</span><br></pre></td></tr></table></figure></p>
<p>ä¸ºäº†åˆ¤æ–­è¿™æ¡å•æµ‹èƒ½å¦é€šè¿‡ï¼Œæˆ‘ä»¬éœ€è¦</p>
<ul>
<li>é€šè¿‡ <code>fs.readFile</code> æ‹¿åˆ° <code>test.spec.js</code> é‡Œçš„ä»£ç ç‰‡æ®µ <code>code</code></li>
<li>æ‰§è¡Œ <code>eval(code)</code>ï¼Œä»£ç ç‰‡æ®µ <code>code</code> è¢«æ‰§è¡Œ</li>
<li><code>try catch</code> ä¸€ä¸‹ <code>eval(code)</code>ï¼Œæ²¡æœ‰æŠ¥é”™åˆ™è¡¨ç¤ºå•æµ‹é€šè¿‡ï¼Œcatch åˆ° error åˆ™è¡¨ç¤ºå•æµ‹ä¸é€šè¿‡</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">runTest</span> (<span class="params">testFile</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> code = <span class="keyword">await</span> fs.promises.readFile(testFile, <span class="string">'utf8'</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">eval</span>(code);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Test Success'</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Test Fail: <span class="subst">$&#123;error.message&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">runTest(<span class="string">'./test.spec.js'</span>)</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="3-å®ç°Expect"><a href="#3-å®ç°Expect" class="headerlink" title="3.å®ç°Expect"></a>3.å®ç°Expect</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œé‡Œè·‘ä¸€ä¸‹ <code>node index.js</code> , ä¼šæç¤º <code>Test Fail: expect is not defined</code>ã€‚ ä»£ç ç‰‡æ®µè¢«æ‰§è¡Œäº†ï¼Œä½†æ˜¯æ­¤æ—¶ node ç¯å¢ƒé‡Œè¿˜æ²¡æœ‰ <code>expect</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª <code>expect</code> æ–¹æ³•ç”¨äºæ–­è¨€ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> expect = <span class="function">(<span class="params">received</span>) =&gt;</span> (&#123;</span><br><span class="line">  toBe: <span class="function">(<span class="params">expected</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (received !== expected) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Expected <span class="subst">$&#123;expected&#125;</span> but received <span class="subst">$&#123;received&#125;</span>.`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">runTest</span> (<span class="params">testFile</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> code = <span class="keyword">await</span> fs.promises.readFile(testFile, <span class="string">'utf8'</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">eval</span>(code);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Test Success'</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Test Fail: <span class="subst">$&#123;error.message&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">runTest(<span class="string">'./test.spec.js'</span>)</span><br></pre></td></tr></table></figure></p>
<p>å½“æµ‹è¯•ç”¨ä¾‹ä¸º<code>expect(2 + 2).toBe(4)</code>ï¼Œæ‰§è¡Œ <code>node index.js</code>ï¼Œå¯ä»¥çœ‹åˆ°æ‰“å°å‡ºæ¥çš„æ˜¯ <code>Test Success</code></p>
<p>æˆ‘ä»¬æŠŠæµ‹è¯•ç”¨ä¾‹æ”¹æˆ<code>expect(2 + 2).toBe(3)</code>ï¼Œæ‰§è¡Œ <code>node index.js</code>ï¼Œå¯ä»¥çœ‹åˆ°æ‰“å°å‡ºæ¥çš„æ˜¯ <code>Test Fail : Expected 3 but received 4</code></p>
<p>çœ‹ï¼Œä¸€ä¸ªç®€æ˜“ç‰ˆ Jest å°±è·‘èµ·æ¥äº†ï¼!</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ Node ç¯å¢ƒé‡Œæ‰§è¡Œ <code>eval(code)</code>ï¼Œå½“ <code>code</code> æ˜¯åŸç”Ÿ JS ä»£ç æ—¶ï¼Œéå¸¸é¡ºç•…æ²¡æœ‰é—®é¢˜ã€‚ä½†è¦çŸ¥é“ï¼Œæˆ‘ä»¬è¦è·‘çš„ <code>code</code> æ˜¯é¡¹ç›®ä»£ç æ–‡ä»¶ï¼Œé‚£éƒ½æ˜¯ä¸€å †æ˜¯ <code>.vue</code> æ–‡ä»¶, <code>.ts</code> æ–‡ä»¶ï¼Œé‡Œé¢æœ‰å¾ˆå¤š Node ä¸æ”¯æŒçš„è¯­æ³•ï¼Œå¦‚ <code>JSX, TypeScript,  Vue æ¨¡æ¿</code>ã€‚</p>
<p>ä¸ºäº†ä½¿ <code>eval(code)</code> é¡ºåˆ©æ‰§è¡Œï¼Œæˆ‘ä»¬éœ€è¦å°†é¡¹ç›®ä»£ç è½¬åŒ–æˆåŸç”ŸJSã€‚è‡³äºæ€ä¹ˆè½¬åŒ–ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†è§£é‡Šã€‚å®é™…é¡¹ç›®ä¸­ï¼Œé€šè¿‡é…ç½® <code>jest.config.js</code> çš„ <code>tranform</code> å±æ€§ï¼ŒJestä¼šå¸®æˆ‘ä»¬å®Œæˆè½¬åŒ–ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jest.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    transform: &#123;</span><br><span class="line">        <span class="string">'.*\\.(vue)$'</span>: <span class="string">'@vue/vue3-jest'</span>, <span class="comment">// ç”¨@vue/vue3-jestå°†.vueæ–‡ä»¶é‡Œçš„ä»£ç ç¼–è¯‘æˆåŸç”ŸJS</span></span><br><span class="line">        <span class="string">'^.+\\.js$'</span>: <span class="string">'babel-jest'</span>, <span class="comment">// ç”¨babel-jestå°†.jsæ–‡ä»¶é‡Œçš„ä»£ç ç¼–è¯‘æˆåŸç”ŸJS</span></span><br><span class="line">        <span class="string">'^.+\\.ts$'</span>: <span class="string">'ts-jest'</span>, <span class="comment">// ç”¨ts-jestå°†.tsæ–‡ä»¶é‡Œçš„ä»£ç ç¼–è¯‘æˆåŸç”ŸJS</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‹¿åˆ°äº†åŸç”Ÿ JS ä»£ç ï¼Œä¹Ÿä¸ä»£è¡¨ <code>eval(code)</code>å¯ä»¥é¡ºåˆ©æ‰§è¡Œã€‚å‰ç«¯ä»£ç ä¸­å¾€å¾€åŒ…å«äº†å¤§é‡çš„ <code>DOM</code> æ“ä½œã€‚è¿™äº›æµè§ˆå™¨æä¾›çš„ API éœ€è¦åœ¨ node ç¯å¢ƒå†…æå‰å®šä¹‰å¥½ï¼Œæ‰èƒ½ä¿è¯ <code>eval(code)</code>é¡ºåˆ©æ‰§è¡Œã€‚</p>
<p>Jest ä¹Ÿåœ¨ Node è¿›ç¨‹é‡Œå†…ç½®äº† <code>JSDom</code>ï¼Œå®ƒä¼šå°†<code>document</code> å¯¹è±¡ã€ <code>window</code> å¯¹è±¡ã€ å…¶ä»– <code>DOM API</code>æ³¨å…¥ <code>Node.js</code> ç¯å¢ƒé‡Œï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ V8 çš„ä¸Šä¸‹æ–‡ä¸­ç¼–è¯‘å’Œæ‰§è¡Œ js ä»£ç ã€‚</p>
<p>æœ‰äº†ä¸Šé¢çš„åŸºç¡€åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹æµ‹è¯• UI ç»„ä»¶äº†!</p>
<p><br></p>
<h3 id="4-ç»„ä»¶æµ‹è¯•-Vue-Util-Test"><a href="#4-ç»„ä»¶æµ‹è¯•-Vue-Util-Test" class="headerlink" title="4.ç»„ä»¶æµ‹è¯•: Vue Util Test"></a>4.ç»„ä»¶æµ‹è¯•: Vue Util Test</h3><p>æ–‡ç« å¼€å¤´è¯´åˆ°ï¼šâ€œæŠŠç”¨æˆ·çš„ç‚¹å‡»è¡Œä¸ºä½œä¸ºè¾“å…¥ï¼ŒæŠŠç»„ä»¶æ¸²æŸ“å‡ºæ¥çš„HTMLä½œä¸ºè¾“å‡ºï¼Œæ˜¯å¯ä»¥éªŒè¯å‰ç«¯ä»£ç çš„æ­£ç¡®æ€§çš„ã€‚â€</p>
<p>å¦‚ä½•æ¨¡æ‹Ÿè¾“å…¥ï¼Ÿå¦‚ä½•è·å–è¾“å‡ºï¼Ÿ</p>
<p>æµ‹è¯• UI ç»„ä»¶å¤§å¤šéœ€è¦å°†å®ƒä»¬æŒ‚è½½åˆ° <code>DOM</code> (è™šæ‹Ÿæˆ–çœŸå®) ä¸Šï¼Œæ‰èƒ½å®Œå…¨æ–­è¨€å®ƒä»¬æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚è¿™é‡Œæˆ‘ä»¬è¦ç”¨åˆ° <code>Vue Test Utils</code>ã€‚å®ƒæ˜¯ Vue å®˜æ–¹çš„ååº•å±‚çš„ç»„ä»¶æµ‹è¯•åº“ï¼Œå®ƒå…è®¸åœ¨nodeè¿›ç¨‹é‡ŒæŒ‚è½½ Vue ç»„ä»¶ï¼Œæ¨¡æ‹Ÿè¾“å…¥ï¼ˆç”¨æˆ·ç‚¹å‡»ï¼Œ <code>prop</code>å’Œæ³¨å…¥ï¼‰ï¼Œè·å–è¾“å‡ºï¼ˆå½“å‰ç»„ä»¶æ¸²æŸ“å‡ºæ¥çš„HTMLï¼‰ã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡ <code>mount</code> æ–¹æ³•æŒ‚è½½ç»„ä»¶ï¼Œè¢«æŒ‚è½½çš„ç»„ä»¶ä¼šè¿”å›ä¸€ä¸ªåŒ…è£¹å™¨ <code>wrapper</code>ã€‚<code>wrapper</code>ä¼šæš´éœ²ä¸€ç³»åˆ— APIï¼Œç”¨äºæ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»è¡Œä¸ºï¼Œè·å–ç»„ä»¶æ¸²æŸ“å‡ºæ¥çš„HTMLã€‚</p>
<p><code>Vue Utils Test</code>æä¾›çš„APIç¤ºä¾‹å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import &#123; mount &#125; from &apos;@vue/test-utils&apos;</span><br><span class="line">import Login from &apos;./Login.vue&apos;</span><br><span class="line"></span><br><span class="line">// æŒ‚è½½ç»„ä»¶ï¼Œå¾—åˆ°Loginç»„ä»¶çš„åŒ…è£¹å™¨ wrapper</span><br><span class="line">const wrapper = mount(Login)</span><br><span class="line"></span><br><span class="line">// æ¨¡æ‹Ÿç”¨æˆ·äº¤äº’</span><br><span class="line">wrapper.find(&apos;.button&apos;).trigger(&apos;click&apos;)</span><br><span class="line"></span><br><span class="line">// è·å–ç»„ä»¶æ¸²æŸ“å‡ºæ¥çš„HTML</span><br><span class="line">wrapper.html()</span><br><span class="line">wrapper.text()</span><br><span class="line"></span><br><span class="line">// nextTick</span><br><span class="line">await Vue.nextTick()</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œç¯å¢ƒå‡†å¤‡å¥½äº†ï¼Œå¯ä»¥æŒ‚è½½Vueç»„ä»¶ï¼Œå¯ä»¥æ¨¡æ‹Ÿç‚¹å‡»ï¼Œå¯ä»¥è·å–ç»„ä»¶æ¸²æŸ“å‡ºæ¥çš„HTMLã€‚</p>
<p>ç»ˆäºæˆ‘ä»¬è¦å†™æµ‹è¯•ç”¨ä¾‹äº†!</p>
<p><br></p>
<h3 id="5-ç¼–å†™æµ‹è¯•ç”¨ä¾‹"><a href="#5-ç¼–å†™æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="5.ç¼–å†™æµ‹è¯•ç”¨ä¾‹"></a>5.ç¼–å†™æµ‹è¯•ç”¨ä¾‹</h3><p>æµ‹è¯•ç”¨ä¾‹ï¼Œä¹Ÿç§°ä¸ºé©±åŠ¨ä»£ç ï¼Œç”¨æ¥è°ƒç”¨è¢«æµ‹ä»£ç ï¼Œå®ƒæ˜¯ä¸€ä¸ª è¾“å…¥æ•°æ® å’Œ é¢„è®¡è¾“å‡º çš„é›†åˆã€‚</p>
<p>è¾“å…¥ï¼š</p>
<ul>
<li>ç”¨æˆ·çš„ç‚¹å‡»è¡Œä¸ºã€é”®ç›˜æ“ä½œ</li>
<li>æœåŠ¡ç«¯è¿”å›çš„æ•°æ®</li>
<li>éœ€è¦åˆ¤æ–­çš„å…¨å±€å˜é‡</li>
</ul>
<p>è¾“å‡ºï¼š</p>
<ul>
<li>é¡µé¢æ˜¾ç¤º</li>
<li>è°ƒç”¨çš„JSAPI</li>
<li>è°ƒç”¨å‚æ•°</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹åŒ…å«äº†è¿™äº›è¦ç´ <br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">'@vue/test-utils'</span></span><br><span class="line"><span class="keyword">import</span> api <span class="keyword">from</span> <span class="string">'@src/api.js'</span></span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">'../src/Login.vue'</span></span><br><span class="line"></span><br><span class="line">describe(<span class="string">'ç™»å½•ç»„ä»¶'</span>, () =&gt;&#123;</span><br><span class="line">  <span class="comment">// æŒ‚è½½è¦æµ‹è¯•çš„ç»„ä»¶</span></span><br><span class="line">  <span class="keyword">const</span> wrapper = mount(Login)</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'ç‚¹å‡»ç™»é™†æŒ‰é’®'</span>, <span class="keyword">async</span>() =&gt; &#123;</span><br><span class="line">    <span class="comment">// ã€è¾“å…¥ã€‘æå‰å®šä¹‰æœåŠ¡ç«¯è¿”å›å†…å®¹</span></span><br><span class="line">    jest</span><br><span class="line">        .spyOn(api, <span class="string">'login'</span>)</span><br><span class="line">        .mockImplementation(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(&#123; <span class="attr">status</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ã€è¾“å…¥ã€‘æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»</span></span><br><span class="line">    <span class="keyword">await</span> wrapper.find(<span class="string">'.button'</span>).trigger(<span class="string">'click'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ã€è¾“å‡ºã€‘æ£€æŸ¥è°ƒç”¨API,è°ƒç”¨å‚æ•°æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">    expect(api.login.mock.calls[<span class="number">0</span>][<span class="number">0</span>]).toEqual(&#123;</span><br><span class="line">        userName: <span class="string">'Mike'</span>,</span><br><span class="line">        passwork: <span class="string">'123456'</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ã€è¾“å‡ºã€‘æ£€æŸ¥é¡µé¢æ˜¯å¦æ­£å¸¸æ˜¾ç¤º</span></span><br><span class="line">    expect(wrapper.text()).toBe(<span class="string">'ç™»å½•æˆåŠŸ'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="6-å®ç°Mock"><a href="#6-å®ç°Mock" class="headerlink" title="6.å®ç°Mock"></a>6.å®ç°Mock</h3><p>é™¤äº†æ£€æŸ¥é¡µé¢å†…å®¹æ˜¯å¦æ­£ç¡®ï¼ŒæœåŠ¡ç«¯è¯·æ±‚æœ‰æ²¡æœ‰å‘å‡ºå»ï¼Œå‘å‡ºå»çš„å‚æ•°æ˜¯æ€æ ·çš„ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ£€æŸ¥å†…å®¹ã€‚è¦æƒ³æ‹¿åˆ°è¿™å†™è¾“å‡ºæ•°æ®ï¼Œéœ€è¦ç”¨åˆ°Mockã€‚Mockçš„ä¸‰ä¸ªç‰¹æ€§ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬å®Œæˆè¿™é¡¹æ£€æŸ¥</p>
<ul>
<li>æ“¦é™¤å‡½æ•°çš„å®é™…å®ç°</li>
<li>è®¾ç½®å‡½æ•°è¿”å›å€¼</li>
<li>æ•è·å‡½æ•°è°ƒç”¨æƒ…å†µ</li>
</ul>
<p><br></p>
<h4 id="6-1-jest-fn"><a href="#6-1-jest-fn" class="headerlink" title="6.1 jest.fn"></a>6.1 jest.fn</h4><p>ä¸ºäº†æ•è·å‡½æ•°çš„è°ƒç”¨æƒ…å†µï¼Œæˆ‘ä»¬è¦ç”¨åˆ°<code>jest.fn</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶è®°å½•è¿™ä¸ªå‡½æ•°è¢«è°ƒç”¨æ—¶çš„å‚æ•°,  thisï¼Œå‡½æ•°è¿”å›å€¼ï¼Œå¹¶è¿”å›è¿™ä¸ªå‡½æ•°ã€‚</p>
<p>æˆ‘ä»¬ç”¨ <code>jest.fn</code>åŒ…è£¹å‡½æ•° <code>add</code>ï¼Œä¸€æ—¦ <code>add</code>è¢«è°ƒç”¨ï¼Œè®¿é—® <code>add.mockå¯ä»¥å¾—åˆ°</code>è¯¥å‡½æ•°çš„è°ƒç”¨æƒ…å†µï¼Œä»è€Œå®ç°æ–­è¨€ã€‚</p>
<p>æˆ‘ä»¬å®ç°ä¸€ä¸ª jest.fn , æ‰§è¡Œ<code>node index.js</code> æ¥çœ‹çœ‹å‡½æ•°è°ƒç”¨æƒ…å†µæ˜¯æ€æ ·è¢«è®°å½•çš„ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®ç°ä¸€ä¸ªjest.fn</span></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> jest = &#123;</span><br><span class="line">  fn: <span class="function"><span class="params">impl</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> mockFn = <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Store the arguments used</span></span><br><span class="line">      mockFn.mock.calls.push(args);</span><br><span class="line">      mockFn.mock.instances.push(<span class="keyword">this</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> value = impl.apply(<span class="keyword">this</span>, args); <span class="comment">// call impl, passing the right this</span></span><br><span class="line">        mockFn.mock.results.push(&#123; <span class="attr">type</span>: <span class="string">'return'</span>, value &#125;);</span><br><span class="line">        <span class="keyword">return</span> value; <span class="comment">// return the value</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (value) &#123;</span><br><span class="line">        mockFn.mock.results.push(&#123; <span class="attr">type</span>: <span class="string">'throw'</span>, value &#125;);</span><br><span class="line">        <span class="keyword">throw</span> value; <span class="comment">// re-throw the error</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mockFn.mock = &#123;</span><br><span class="line">      calls: [],</span><br><span class="line">      instances: [],</span><br><span class="line">      results: []</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ ä¸ªmockImplementationæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">return</span> mockFn</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨jest.fnåŒ…è£¹addå‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> add = jest.fn(<span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨addæ—¶ï¼Œadd.mockä¼šè®°å½•è°ƒç”¨æ—¶çš„å‚æ•°ï¼Œthiså€¼ï¼Œè¿”å›å€¼</span></span><br><span class="line">add(<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">console</span>.log(add.mock)</span><br><span class="line"><span class="comment">// &#123; calls: [[2, 2]], instances: [Window], results: [&#123; type: 'return', value: 4&#125;] &#125;</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="6-2-jest-spyOn"><a href="#6-2-jest-spyOn" class="headerlink" title="6.2 jest.spyOn"></a>6.2 jest.spyOn</h4><p>å¯æ˜¯å®é™…ä¸­ï¼Œ<code>jest.fn</code>å¹¶ä¸å¸¸ç”¨ã€‚æˆ‘ä»¬æƒ³ç›‘å¬çš„æ˜¯å†™åœ¨é¡¹ç›®é‡Œçš„æ–¹æ³•çš„è°ƒç”¨æƒ…å†µã€‚</p>
<p>è¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ <code>jest.spyOn</code>ï¼Œ<code>jest.spyOn(object, methodName)</code> ç»™ç°æœ‰å¯¹è±¡é‡Œçš„å‡½æ•°æ·»åŠ  mockï¼Œå½“å¯¹è±¡é‡Œçš„å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œè®¿é—® <code>object[methodName].mock</code> å¯ä»¥è·å–è¯¥å‡½æ•°çš„è°ƒç”¨æƒ…å†µã€‚</p>
<p>å®ç°jest.spyOnï¼Œè¦è·Ÿç€ä¸€èµ·æ•²ï¼Œæ•²å®Œå°±æ‡‚äº†<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">jest.spyOn = <span class="function">(<span class="params">obj, prop</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ä¿ç•™åŸå§‹çš„obj[prop]</span></span><br><span class="line">  <span class="keyword">const</span> originFunc = obj[prop]</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç»™obj[prop]æ–¹æ³•åŒ…è£¹ä¸€å±‚jest.fnï¼Œå¹¶èµ‹å€¼æ›¿æ¢</span></span><br><span class="line">  obj[prop] = jest.fn(obj[prop])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// mockRestore: æä¾›å¤åŸobj[prop]çš„æ–¹æ³•</span></span><br><span class="line">  obj[prop].mockRestore = <span class="function"><span class="params">()</span> =&gt;</span> (obj[prop] = originFunc)</span><br><span class="line">  <span class="keyword">return</span> obj[prop]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api = &#123;</span><br><span class="line">  add: <span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jest.spyOn(api, <span class="string">'add'</span>)</span><br><span class="line">api.add(<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line"><span class="built_in">console</span>.log(api.add.mock)</span><br><span class="line"><span class="comment">// &#123; calls: [[2, 2]], instances: [Window], results: [&#123; type: 'return', value: 4&#125;] &#125;</span></span><br></pre></td></tr></table></figure></p>
<p>æœ‰äº†è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬è¦mocké¡¹ç›®ä»£ç é‡Œçš„æ–¹æ³•ï¼Œå°±å¯ä»¥è¿™æ ·å†™</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> api <span class="keyword">from</span> <span class="string">'@src/api'</span>jest.spyOn(api,Â <span class="string">'login'</span>)</span><br></pre></td></tr></table></figure>
<p>å•æµ‹æ‰§è¡Œæ—¶ï¼Œä»»æ„ä¸€ä¸ªåœ°æ–¹è°ƒç”¨äº†api.loginï¼Œå®ƒçš„è°ƒç”¨æƒ…å†µå°±ä¼šè¢«è®°å½•ä¸‹æ¥ã€‚</p>
<p><br></p>
<h4 id="6-3-jest-fn-mockImplementation"><a href="#6-3-jest-fn-mockImplementation" class="headerlink" title="6.3 jest.fn.mockImplementation"></a>6.3 jest.fn.mockImplementation</h4><p>é™¤äº†ç›‘å¬å‡½æ•°çš„è°ƒç”¨æƒ…å†µï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›å¯ä»¥ç›´æ¥æŒ‡å®šå‡½æ•°çš„è¿”å›å€¼ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œå°±è¦ç”¨åˆ° <code>mockImplementation</code>ã€‚ æˆ‘ä»¬éœ€è¦æ”¹å†™ä¸€ä¸‹å‰é¢å®šä¹‰çš„ jest.fnï¼Œç»™è¦è¿”å›å‡ºå»çš„é«˜é˜¶å‡½æ•°ï¼ŒåŠ ä¸Š<code>mockImplementation</code> æ–¹æ³•ï¼Œç”¨äºæ”¹å˜åŸå‡½æ•°çš„å€¼ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ ä¸ªmockImplementationæ–¹æ³•mockFn.mockImplementationÂ =Â newImplÂ =&gt;Â (implÂ =Â newImpl)</span></span><br></pre></td></tr></table></figure>
<p><code>jest.fn.mockImplementation</code> å®Œæ•´ä»£ç å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jest = &#123;</span><br><span class="line">    fn: <span class="function"><span class="params">impl</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> mockFn = <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// Store the arguments used</span></span><br><span class="line">            mockFn.mock.calls.push(args);</span><br><span class="line">            mockFn.mock.instances.push(<span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> value = impl.apply(<span class="keyword">this</span>, args); <span class="comment">// call impl, passing the right this</span></span><br><span class="line">                mockFn.mock.results.push(&#123; <span class="attr">type</span>: <span class="string">'return'</span>, value &#125;);</span><br><span class="line">                <span class="keyword">return</span> value; <span class="comment">// return the value</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (value) &#123;</span><br><span class="line">                mockFn.mock.results.push(&#123; <span class="attr">type</span>: <span class="string">'throw'</span>, value &#125;);</span><br><span class="line">                <span class="keyword">throw</span> value; <span class="comment">// re-throw the error</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mockFn.mock = &#123;</span><br><span class="line">            calls: [],</span><br><span class="line">            instances: [],</span><br><span class="line">            results: []</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ ä¸ªmockImplementationæ–¹æ³•</span></span><br><span class="line">        mockFn.mockImplementation = <span class="function"><span class="params">newImpl</span> =&gt;</span> (impl = newImpl)</span><br><span class="line">        <span class="keyword">return</span> mockFn</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jest.spyOn = <span class="function">(<span class="params">obj, prop</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿ç•™åŸå§‹çš„obj[prop]</span></span><br><span class="line">    <span class="keyword">const</span> originFunc = obj[prop]</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»™obj[prop]æ–¹æ³•åŒ…è£¹ä¸€å±‚jest.fnï¼Œå¹¶èµ‹å€¼æ›¿æ¢</span></span><br><span class="line">    obj[prop] = jest.fn(obj[prop])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// mockRestore: æä¾›å¤åŸobj[prop]çš„æ–¹æ³•</span></span><br><span class="line">    obj[prop].mockRestore = <span class="function"><span class="params">()</span> =&gt;</span> (obj[prop] = originFunc)</span><br><span class="line">    <span class="keyword">return</span> obj[prop]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api = &#123;</span><br><span class="line">    add: <span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jest.spyOn(api, <span class="string">'add'</span>).mockImplementation(<span class="function"><span class="params">()</span> =&gt;</span> <span class="number">100</span>)</span><br><span class="line">api.add(<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line"><span class="built_in">console</span>.log(api.add.mock)</span><br><span class="line"><span class="comment">// å¯ä»¥çœ‹åˆ°api.add()è¿”å›çš„å€¼æ€»æ˜¯100</span></span><br><span class="line"><span class="comment">// &#123; calls: [[2, 2]], instances: [Window], results: [&#123; type: 'return', value: 100&#125;] &#125;</span></span><br></pre></td></tr></table></figure>
<p>åˆ°è¿™é‡Œï¼Œå‡ ä¹æ‰€æœ‰æˆ‘ä»¬æƒ³è¦çš„è¾“å…¥è¾“å‡ºéƒ½æ‹¿åˆ°äº†ï¼Œå•æµ‹ä¹Ÿè·‘èµ·æ¥äº†</p>
<p><br></p>
<h3 id="7-é…ç½®Stub"><a href="#7-é…ç½®Stub" class="headerlink" title="7. é…ç½®Stub"></a>7. é…ç½®Stub</h3><p>ä½†è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå•æµ‹å¾€å¾€ä¼šè·‘åˆ°ä¸€äº›å¤–éƒ¨å‡½æ•°ã€‚è€Œè¿™ä¸ªå¤–éƒ¨å‡½æ•°ï¼Œåœ¨å•å…ƒæµ‹è¯•æ‰§è¡Œç¯å¢ƒé‡Œæœªè¢«å®ç°ï¼Œä¸”æ˜¯æˆ‘ä»¬ä¸æ„Ÿå…´è¶£çš„ä»£ç ï¼Œä¸ºäº†ä¸å½±å“è‡ªèº«é€»è¾‘çš„æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå‡çš„å‡½æ•°æ¥ä»£æ›¿çœŸå®çš„å‡½æ•°Aï¼Œè¿™å°±æ˜¯stubã€‚</p>
<p>ä¸€ä¸ª stub å°±æ˜¯ç®€å•çš„ä¸€æ®µæ›¿èº«ä»£ç ã€‚stubåœ¨å±è”½ä¸å½“å‰å•å…ƒæµ‹è¯•æ— å…³è¡Œä¸ºæ–¹é¢å¾ˆæœ‰ç”¨ï¼Œèµ·åˆ°äº†éš”ç¦»å’Œè¡¥é½çš„ä½œç”¨ï¼Œä½¿è¢«æµ‹ä»£ç èƒ½å¤Ÿç‹¬ç«‹ç¼–è¯‘ã€è¿è¡Œã€‚</p>
<p>å¸¸è§éœ€è¦è¢«stubçš„ä»£ç ï¼š</p>
<ul>
<li>HTTPè¯·æ±‚è¿”å›å€¼</li>
<li>cssæ–‡ä»¶ã€å›¾ç‰‡ã€å­—ä½“æ–‡ä»¶</li>
<li>JSDomæ²¡æœ‰æä¾›çš„æµè§ˆå™¨APIï¼Œå¦‚Worker, Canvas</li>
<li>å…¶ä»–å¯ä»¥å¿½ç•¥æ‰çš„ç»„ä»¶ï¼Œæ–¹æ³•ç­‰ç­‰</li>
</ul>
<p>å®é™…é¡¹ç›®ä¸­ï¼Œå¯ä»¥é€šè¿‡é…ç½® jest.config.js ä¸­çš„ <code>moduleNameMapper</code>å±æ€§æ¥æŒ‡å®šä½ è¦ stub çš„ä»£ç ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jest.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    moduleNameMapper: &#123;</span><br><span class="line">        <span class="string">'\\.(css|less|sass|scss|jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$'</span>: <span class="string">'&lt;rootDir&gt;/file-mock.js'</span>,</span><br><span class="line">        <span class="string">'@src/api'</span>: <span class="string">'&lt;rootDir&gt;/api-mock.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// file-mock.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="string">'file-stub'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// api-mock.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    getUserInfo: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(&#123;</span><br><span class="line">            username: <span class="string">'Mike'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>End.</p>

    </div>
  </article>
    
    <div class="post-nav">
      <div class="post-nav-item post-nav-next">
        
          <span>ã€ˆ </span>
          <a href="/2022/02/12/CSSä¸–ç•Œ/" rel="next" title="ã€ŠCSSä¸–ç•Œã€‹ç¬”è®°">
          ã€ŠCSSä¸–ç•Œã€‹ç¬”è®°
          </a>
        
      </div>
  
      <div class="post-nav-item post-nav-prev">
        
          <a href="/2022/06/26/Axios/" rel="prev" title="XHRï¼šå®ç°ä¸€ä¸ªAxios">
            XHRï¼šå®ç°ä¸€ä¸ªAxios
          </a>
          <span>ã€‰</span>
        
      </div>
    </div>
  
</div>


<script>
var link = document.getElementsByClassName('toc-link');
var hash = decodeURIComponent(location.hash);
if (hash){
} else {
  link[0].classList.add('toc-link-active');
}

var h3 = document.getElementsByTagName('h3');
var h4 = document.getElementsByTagName('h4');
var h5 = document.getElementsByTagName('h5');
var link_arr = [];
function addToArr(arr){
  for(var i = 0; i < arr.length; i++){
    link_arr.push(arr[i].offsetTop);
  }
}
addToArr(h3);
addToArr(h4);
addToArr(h5);


var compare = function (x, y) {
    if (x < y) {
        return -1;
    } else if (x > y) {
        return 1;
    } else {
        return 0;
    }
}

link_arr.sort(compare);


window.onscroll = function(){
  var height = document.documentElement.scrollTop;
  for (var i = 0; i < link_arr.length; i++){
    if (link_arr[i] > height){
      for(var j = 0; j < link.length; j++){
        link[j].classList.remove('toc-link-active');
      }
      document.getElementsByClassName('toc-link')[i].classList.add('toc-link-active');
      break;
    } 
  }
}

</script>
    </div>
  </div>
  




    <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js"></script>
      
    
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // listen to any DOM change and automatically perform spacing via MutationObserver()
        pangu.autoSpacingPage();
      });

      window.addEventListener("load", event => {
        // åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒ
        if ("serviceWorker" in navigator) {
          window.navigator.serviceWorker
            .register("/sw.js", {
              scope: "/"
            })
        }
      });
    </script>
</body>
</html>

