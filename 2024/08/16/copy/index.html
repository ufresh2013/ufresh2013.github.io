
<!DOCTYPE html>
<html lang="">


  <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#202020">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    
        <meta name="keywords" content="">
        

          
              <meta name="description" content="Blob, toBlob, FileReader æ–‡ä»¶æ“ä½œ &amp; å¤åˆ¶">
              

                <link rel="icon" type="image/x-icon" href="data:image/png;base64,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">
                <title>
                  Blob, toBlob, FileReader æ–‡ä»¶æ“ä½œ &amp; å¤åˆ¶ [ å¼€å‘ç¬”è®° ]
                </title>
                
                  <!-- stylesheets list from config.yml -->
                  
                    <link rel="stylesheet" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css">
                    
                    <link rel="stylesheet" href="/css/microb.css">
                    
                      
  </head>

<body>
  <div class="container" id="content-outer">
    <div class="inner" id="content-inner">
        <div class="tab">
            <a href="/"><img src="/left.png" /></a>
            <span><a href="/">å¼€å‘ç¬”è®°</a></span>
            <!-- <span><a class="tab-search" href="/search/">æœç´¢</a></span> -->
            
              <span><a class="tab-title" id="#Browser" href="/#Browser">Browser</a></span>
            
              <span><a class="tab-title" id="#Bug" href="/#Bug">Bug</a></span>
            
              <span><a class="tab-title" id="#CSS" href="/#CSS">CSS</a></span>
            
              <span><a class="tab-title" id="#HTML" href="/#HTML">HTML</a></span>
            
              <span><a class="tab-title" id="#HTTP" href="/#HTTP">HTTP</a></span>
            
              <span><a class="tab-title" id="#JS" href="/#JS">JS</a></span>
            
              <span><a class="tab-title" id="#LeetCode" href="/#LeetCode">LeetCode</a></span>
            
              <span><a class="tab-title" id="#NodeJS" href="/#NodeJS">NodeJS</a></span>
            
              <span><a class="tab-title" id="#Other" href="/#Other">Other</a></span>
            
              <span><a class="tab-title" id="#Work" href="/#Work">Work</a></span>
            
              <span><a class="tab-title" id="#éšç¬”" href="/#éšç¬”">éšç¬”</a></span>
            
          </div>
      
  <div id="toc" class="toc-article">
    <!--<strong class="toc-title">ç›®å½•</strong>-->
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Blob"><span class="toc-text">1. Blob</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-ä¸‹è½½æ–‡ä»¶"><span class="toc-text">1.1 ä¸‹è½½æ–‡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-ä¸Šä¼ æ–‡ä»¶"><span class="toc-text">1.2 ä¸Šä¼ æ–‡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-å¤§æ–‡ä»¶çš„åˆ†æ®µä¸‹è½½"><span class="toc-text">1.3 å¤§æ–‡ä»¶çš„åˆ†æ®µä¸‹è½½</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-toBlob"><span class="toc-text">2. toBlob</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-å¤åˆ¶-canvas-svg-ä¸ºå›¾ç‰‡"><span class="toc-text">2.1 å¤åˆ¶ canvas / svg ä¸ºå›¾ç‰‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-å¤åˆ¶-div-ä¸ºå›¾ç‰‡"><span class="toc-text">2.2 å¤åˆ¶ div ä¸ºå›¾ç‰‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-å¤åˆ¶æ–‡æœ¬"><span class="toc-text">2.3 å¤åˆ¶æ–‡æœ¬</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-FileReader"><span class="toc-text">3. FileReader</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-è¯»å–æ–‡ä»¶æ–‡æœ¬å†…å®¹"><span class="toc-text">3.1 è¯»å–æ–‡ä»¶æ–‡æœ¬å†…å®¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-è¯»å–å›¾ç‰‡å¹¶é¢„è§ˆ"><span class="toc-text">3.2 è¯»å–å›¾ç‰‡å¹¶é¢„è§ˆ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å‚è€ƒèµ„æ–™"><span class="toc-text">å‚è€ƒèµ„æ–™</span></a></li></ol>
  </div>


<div class="section">
  <article class="post" id="post">
    <header class="post-header text-center">
      <h1 class="title">
        Blob, toBlob, FileReader æ–‡ä»¶æ“ä½œ &amp; å¤åˆ¶
      </h1>
      
      <time class="time" datetime="2024-08-16T14:44:14.000Z">
        2024-08-16
      </time>
      
      <hr>
    </header>
    <div class="post-content">
      <h3 id="1-Blob"><a href="#1-Blob" class="headerlink" title="1. Blob"></a>1. Blob</h3><p>Blobè¡¨ç¤ºä¸å¯å˜çš„åŸå§‹æ•°æ®ï¼Œå¯ä»¥æ˜¯äºŒè¿›åˆ¶æ•°æ®æˆ–æ–‡æœ¬æ•°æ®ã€‚</p>
<h4 id="1-1-ä¸‹è½½æ–‡ä»¶"><a href="#1-1-ä¸‹è½½æ–‡ä»¶" class="headerlink" title="1.1 ä¸‹è½½æ–‡ä»¶"></a>1.1 ä¸‹è½½æ–‡ä»¶</h4><p><em><code>new Blob()</code></em>åˆ›å»ºä¸€ä¸ªBlobå¯¹è±¡å¯ä»¥æ–¹ä¾¿åœ°å°†æ•°æ®è½¬æ¢ä¸ºæ–‡ä»¶å½¢å¼ï¼Œå¹¶é€šè¿‡<em><code>URL.createObjectURL</code></em>ç”Ÿæˆä¸´æ—¶URLç”¨äºä¸‹è½½æˆ–æ˜¾ç¤ºã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'downloadBtn'</span>).addEventListener(<span class="string">'click'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> content = <span class="string">'è¿™æ˜¯ä¸€ä¸ªé€šè¿‡Blobåˆ›å»ºçš„æ–‡æœ¬æ–‡ä»¶ã€‚'</span>;</span><br><span class="line">  <span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([content], &#123; <span class="attr">type</span>: <span class="string">'text/plain;charset=utf-8'</span> &#125;);</span><br><span class="line">  <span class="keyword">const</span> url = URL.createObjectURL(blob);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</span><br><span class="line">  a.href = url;</span><br><span class="line">  a.download = <span class="string">'example.txt'</span>;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(a);</span><br><span class="line">  a.click();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡Šæ”¾URLå¯¹è±¡</span></span><br><span class="line">  URL.revokeObjectURL(url);</span><br><span class="line">  <span class="built_in">document</span>.body.removeChild(a);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h4 id="1-2-ä¸Šä¼ æ–‡ä»¶"><a href="#1-2-ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="1.2 ä¸Šä¼ æ–‡ä»¶"></a>1.2 ä¸Šä¼ æ–‡ä»¶</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'uploadBtn'</span>).addEventListener(<span class="string">'click'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> fileInput = <span class="built_in">document</span>.getElementById(<span class="string">'fileInput'</span>);</span><br><span class="line">  <span class="keyword">const</span> file = fileInput.files[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!file) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ›å»ºFormDataå¯¹è±¡, ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">const</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">  formData.append(<span class="string">'image'</span>, file);</span><br><span class="line">  fetch(<span class="string">'https://example.com/upload'</span>, &#123;</span><br><span class="line">    method: <span class="string">'POST'</span>,</span><br><span class="line">    body: formData,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="1-3-å¤§æ–‡ä»¶çš„åˆ†æ®µä¸‹è½½"><a href="#1-3-å¤§æ–‡ä»¶çš„åˆ†æ®µä¸‹è½½" class="headerlink" title="1.3 å¤§æ–‡ä»¶çš„åˆ†æ®µä¸‹è½½"></a>1.3 å¤§æ–‡ä»¶çš„åˆ†æ®µä¸‹è½½</h4><p>å¤§æ–‡ä»¶åˆ†æ®µä¸‹è½½ï¼Œè·Ÿå¤§æ–‡ä»¶ä¸Šä¼ æ—¶è¦åˆ‡ç‰‡çš„åˆå¿ƒä¸€æ ·ï¼Œæ˜¯ä¸ºäº†â€œå¿«â€ã€‚åˆ©ç”¨ HTTP è¯·æ±‚å¤´ <em><code>Range</code></em>æ§åˆ¶ä¸‹è½½ç‰‡æ®µï¼Œèƒ½å¤ŸåŒæ—¶ä¸‹è½½ä¸€ä¸ªå¤§æ–‡ä»¶çš„å¤šä¸ªç‰‡æ®µï¼Œç„¶åç»„è£…èµ·æ¥ï¼Œé‚£å°†èƒ½å¤Ÿå……åˆ†åˆ©ç”¨æˆ‘ä»¬çš„ç½‘ç»œèµ„æºï¼ŒåŠ é€Ÿä¸‹è½½ã€‚<br>ps: å®ç°<em>æš‚åœä¸‹è½½</em>ï¼Œåˆ™æ˜¯å–æ¶ˆæ‰€æœ‰æœªå®Œæˆçš„è¯·æ±‚ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¹¶å‘åˆ†æ®µä¸‹è½½</span></span><br><span class="line">axios.get(linkUrl, &#123;</span><br><span class="line">  headers: &#123;</span><br><span class="line">    Range: <span class="string">`bytes=<span class="subst">$&#123;start&#125;</span>-<span class="subst">$&#123;end&#125;</span>`</span>,</span><br><span class="line">    responseType: <span class="string">'blob'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå¹¶åˆ†æ®µ</span></span><br><span class="line"><span class="keyword">const</span> blobs = <span class="keyword">await</span> <span class="built_in">Promise</span>.all(tasks)</span><br><span class="line"><span class="keyword">const</span> blob = <span class="keyword">new</span> Blob(</span><br><span class="line">  blobs.map(<span class="function"><span class="params">blob</span> =&gt;</span> blob.data),</span><br><span class="line">  &#123; <span class="attr">type</span>: mime &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿å­˜ä¸ºæ–‡ä»¶ï¼Œè§1.1 ä¸‹è½½æ–‡ä»¶</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2-toBlob"><a href="#2-toBlob" class="headerlink" title="2. toBlob"></a>2. toBlob</h3><p><code>HTMLCanvasElement.toBlob(callback, type, quality)</code> æ–¹æ³•åˆ›é€  Blob å¯¹è±¡ï¼Œç”¨ä»¥å±•ç¤º canvas ä¸Šçš„å›¾ç‰‡ï¼›è¿™ä¸ªå›¾ç‰‡æ–‡ä»¶å¯ä»¥è¢«ç¼“å­˜æˆ–ä¿å­˜åˆ°æœ¬åœ°ã€‚</p>
<ul>
<li><code>callback</code>: å›è°ƒå‡½æ•°ï¼Œå¯è·å¾—ä¸€ä¸ªå•ç‹¬çš„ Blob å¯¹è±¡å‚æ•°</li>
<li><code>type</code>: string, æŒ‡å®šå›¾ç‰‡æ ¼å¼ï¼Œé»˜è®¤ä¸º image/pngã€‚<ul>
<li>text/plain - çº¯æ–‡æœ¬æ–‡æ¡£</li>
<li>text/html - htmlæ–‡æ¡£</li>
<li>text/javascript - jsæ–‡ä»¶</li>
<li>text/css - cssæ–‡ä»¶</li>
<li>application/json - jsonæ–‡ä»¶</li>
<li>application/pdf - pdfæ–‡ä»¶</li>
<li>application/xml - xmlæ–‡ä»¶</li>
<li>image/jpeg - jpegå›¾åƒ</li>
<li>image/png - pngå›¾åƒ</li>
<li>image/gif - gifå›¾åƒ</li>
<li>image/svg+xml - svgå›¾åƒ</li>
<li>audio/mpeg - mp3æ–‡ä»¶</li>
<li>video/mpeg - mp4æ–‡ä»¶</li>
</ul>
</li>
<li><code>quality</code>: Number ç±»å‹ï¼Œå€¼åœ¨ 0 ä¸ 1 ä¹‹é—´ï¼Œå½“è¯·æ±‚å›¾ç‰‡æ ¼å¼ä¸º image/jpeg æˆ–è€… image/webp æ—¶ç”¨æ¥æŒ‡å®šå›¾ç‰‡å±•ç¤ºè´¨é‡ã€‚</li>
<li><em><code>canvasHTMLElement.toBlob</code></em>å¯ä»¥ç”¨æ¥å®ç°å¤åˆ¶æ•ˆæœ<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">copyBlob</span>(<span class="params">blob: Blob | null</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!blob) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">if</span> (!navigator.clipboard || !navigator.clipboard.write) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">const</span> data = [<span class="keyword">new</span> ClipboardItem(&#123; [blob.type]: blob &#125;)]</span><br><span class="line">  navigator.clipboard.write(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-å¤åˆ¶-canvas-svg-ä¸ºå›¾ç‰‡"><a href="#2-1-å¤åˆ¶-canvas-svg-ä¸ºå›¾ç‰‡" class="headerlink" title="2.1 å¤åˆ¶ canvas / svg ä¸ºå›¾ç‰‡"></a>2.1 å¤åˆ¶ canvas / svg ä¸ºå›¾ç‰‡</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getChartBlob</span>(<span class="params">title: string | null</span>): <span class="title">Promise</span>&lt;<span class="title">Blob</span> | <span class="title">null</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> chartDiv = <span class="built_in">document</span>.getElementById(<span class="string">`chart-container`</span>) <span class="keyword">as</span> HTMLElement</span><br><span class="line">    <span class="keyword">const</span> svgElement = chartDiv.querySelector(<span class="string">'svg'</span>) <span class="keyword">as</span> SVGElement</span><br><span class="line">    <span class="keyword">const</span> svgXML = <span class="keyword">new</span> XMLSerializer().serializeToString(svgElement)</span><br><span class="line">    <span class="keyword">const</span> chartWidth = svgElement.clientWidth * <span class="number">1.5</span></span><br><span class="line">    <span class="keyword">const</span> chartHeight = svgElement.clientHeight * <span class="number">1.5</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„canvaså…ƒç´ </span></span><br><span class="line">    <span class="keyword">const</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>) <span class="keyword">as</span> HTMLCanvasElement</span><br><span class="line">    <span class="keyword">const</span> context = canvas.getContext(<span class="string">'2d'</span>) <span class="keyword">as</span> CanvasRenderingContext2D</span><br><span class="line">    canvas.width = chartWidth + <span class="number">32</span></span><br><span class="line">    canvas.height = title</span><br><span class="line">      ? chartHeight + <span class="number">66</span> <span class="comment">// å›¾è¡¨æ ‡é¢˜å 34px</span></span><br><span class="line">      : chartHeight + <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„Imageå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">const</span> image = <span class="keyword">new</span> Image()</span><br><span class="line">    image.src = <span class="string">'data:image/svg+xml;charset=utf8,'</span> + <span class="built_in">encodeURIComponent</span>(svgXML)</span><br><span class="line">    image.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      context.fillStyle = <span class="string">'#fff'</span></span><br><span class="line">      context.fillRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height)</span><br><span class="line">      <span class="keyword">if</span> (title) &#123;</span><br><span class="line">        context.fillStyle = <span class="string">'rgba(13,13,13,0.9)'</span></span><br><span class="line">        context.font = <span class="string">'14px Arial'</span></span><br><span class="line">        <span class="keyword">const</span> textWidth = context.measureText(title).width</span><br><span class="line">        <span class="keyword">const</span> x = (canvas.width - textWidth) / <span class="number">2</span></span><br><span class="line">        context.fillText(title, x, <span class="number">30</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      context.drawImage(image, <span class="number">16</span>, title ? <span class="number">50</span> : <span class="number">16</span>, chartWidth, chartHeight)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å°†canvaså›¾åƒè½¬æ¢ä¸ºå›¾ç‰‡æ–‡ä»¶</span></span><br><span class="line">      canvas.toBlob(</span><br><span class="line">        <span class="keyword">async</span> blob =&gt; &#123;</span><br><span class="line">          <span class="keyword">return</span> resolve(blob)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'image/png'</span>,</span><br><span class="line">        <span class="number">0.5</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤åˆ¶svgå›¾è¡¨</span></span><br><span class="line"><span class="keyword">const</span> res = <span class="keyword">await</span> getChartBlob(<span class="string">'å›¾è¡¨æ ‡é¢˜'</span>)</span><br><span class="line">copyBlob(res)</span><br></pre></td></tr></table></figure>
<h4 id="2-2-å¤åˆ¶-div-ä¸ºå›¾ç‰‡"><a href="#2-2-å¤åˆ¶-div-ä¸ºå›¾ç‰‡" class="headerlink" title="2.2 å¤åˆ¶ div ä¸ºå›¾ç‰‡"></a>2.2 å¤åˆ¶ div ä¸ºå›¾ç‰‡</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> html2canvas <span class="keyword">from</span> <span class="string">'html2canvas'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getTableBlob</span>(<span class="params"></span>): <span class="title">Promise</span>&lt;<span class="title">Blob</span> | <span class="title">null</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="keyword">async</span> resolve =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> table = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'base-table'</span>)[<span class="number">0</span>] <span class="keyword">as</span> HTMLElement</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å›¾ç‰‡æ•°æ®URLæ”¾åˆ°ç²˜è´´æ¿ä¸Š</span></span><br><span class="line">    <span class="keyword">const</span> canvas = <span class="keyword">await</span> html2canvas(table)</span><br><span class="line">    canvas.toBlob(</span><br><span class="line">      <span class="keyword">async</span> blob =&gt; &#123;</span><br><span class="line">        resolve(blob)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">'image/png'</span>,</span><br><span class="line">      <span class="number">0.9</span></span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res = <span class="keyword">await</span> getTableBlob()</span><br><span class="line">copyBlob(res)</span><br></pre></td></tr></table></figure>
<h4 id="2-3-å¤åˆ¶æ–‡æœ¬"><a href="#2-3-å¤åˆ¶æ–‡æœ¬" class="headerlink" title="2.3 å¤åˆ¶æ–‡æœ¬"></a>2.3 å¤åˆ¶æ–‡æœ¬</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">copyText</span>(<span class="params">text: string</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> tempEl = <span class="built_in">document</span>.createElement(<span class="string">'textarea'</span>)</span><br><span class="line">  tempEl.value = text</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(tempEl)</span><br><span class="line">  tempEl.select()</span><br><span class="line">  <span class="built_in">document</span>.execCommand(<span class="string">'copy'</span>)</span><br><span class="line">  <span class="built_in">document</span>.body.removeChild(tempEl)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-FileReader"><a href="#3-FileReader" class="headerlink" title="3. FileReader"></a>3. FileReader</h3><h4 id="3-1-è¯»å–æ–‡ä»¶æ–‡æœ¬å†…å®¹"><a href="#3-1-è¯»å–æ–‡ä»¶æ–‡æœ¬å†…å®¹" class="headerlink" title="3.1 è¯»å–æ–‡ä»¶æ–‡æœ¬å†…å®¹"></a>3.1 è¯»å–æ–‡ä»¶æ–‡æœ¬å†…å®¹</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'textFileInput'</span>).addEventListener(<span class="string">'change'</span>, (event) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = event.target.files[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (file) &#123;</span><br><span class="line">    <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line"></span><br><span class="line">    reader.onload = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">document</span>.getElementById(<span class="string">'textContent'</span>).textContent = e.target.result;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    reader.onerror = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      alert(<span class="string">'æ–‡ä»¶è¯»å–å¤±è´¥ï¼'</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    reader.readAsText(file);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="3-2-è¯»å–å›¾ç‰‡å¹¶é¢„è§ˆ"><a href="#3-2-è¯»å–å›¾ç‰‡å¹¶é¢„è§ˆ" class="headerlink" title="3.2 è¯»å–å›¾ç‰‡å¹¶é¢„è§ˆ"></a>3.2 è¯»å–å›¾ç‰‡å¹¶é¢„è§ˆ</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'imageFileInput'</span>).addEventListener(<span class="string">'change'</span>, (event) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = event.target.files[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (file &amp;&amp; file.type.startsWith(<span class="string">'image/'</span>)) &#123;</span><br><span class="line">    <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line"></span><br><span class="line">    reader.onload = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> img = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">      img.src = e.target.result;</span><br><span class="line">      img.alt = <span class="string">'é¢„è§ˆå›¾ç‰‡'</span>;</span><br><span class="line">      img.width = <span class="number">300</span>;</span><br><span class="line">      <span class="built_in">document</span>.getElementById(<span class="string">'imagePreview'</span>).appendChild(img);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    reader.onerror = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      alert(<span class="string">'å›¾ç‰‡åŠ è½½å¤±è´¥ï¼'</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    reader.readAsDataURL(file);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    alert(<span class="string">'è¯·é€‰æ‹©ä¸€å¼ å›¾ç‰‡æ–‡ä»¶ã€‚'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul>
<li><a href="https://juejin.cn/post/7444467218070323210?searchId=20241229213222203B42E54AFE0FF45949" target="_blank" rel="noopener">å‰ç«¯Blobã€Fileã€FileReaderã€ArrayBufferå‚»å‚»åˆ†ä¸æ¸…</a></li>
</ul>

    </div>
  </article>
    
    <div class="post-nav">
      <div class="post-nav-item post-nav-next">
        
          <span>ã€ˆ </span>
          <a href="/2022/06/26/Axios/" rel="next" title="XHRï¼šå®ç°ä¸€ä¸ªAxios">
          XHRï¼šå®ç°ä¸€ä¸ªAxios
          </a>
        
      </div>
  
      <div class="post-nav-item post-nav-prev">
        
          <a href="/2024/08/25/Vueå’ŒReactçš„åŒºåˆ«/" rel="prev" title="ğŸ¤” Vueå’ŒReactçš„åŒºåˆ«">
            ğŸ¤” Vueå’ŒReactçš„åŒºåˆ«
          </a>
          <span>ã€‰</span>
        
      </div>
    </div>
  
</div>


<script>
var link = document.getElementsByClassName('toc-link');
var hash = decodeURIComponent(location.hash);
if (hash){
} else {
  link[0].classList.add('toc-link-active');
}

var h3 = document.getElementsByTagName('h3');
var h4 = document.getElementsByTagName('h4');
var h5 = document.getElementsByTagName('h5');
var link_arr = [];
function addToArr(arr){
  for(var i = 0; i < arr.length; i++){
    link_arr.push(arr[i].offsetTop);
  }
}
addToArr(h3);
addToArr(h4);
addToArr(h5);


var compare = function (x, y) {
    if (x < y) {
        return -1;
    } else if (x > y) {
        return 1;
    } else {
        return 0;
    }
}

link_arr.sort(compare);


window.onscroll = function(){
  var height = document.documentElement.scrollTop;
  for (var i = 0; i < link_arr.length; i++){
    if (link_arr[i] > height){
      for(var j = 0; j < link.length; j++){
        link[j].classList.remove('toc-link-active');
      }
      document.getElementsByClassName('toc-link')[i].classList.add('toc-link-active');
      break;
    } 
  }
}

</script>
    </div>
  </div>
  




    <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js"></script>
      
    
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // listen to any DOM change and automatically perform spacing via MutationObserver()
        pangu.autoSpacingPage();
      });

      window.addEventListener("load", event => {
        // åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒ
        if ("serviceWorker" in navigator) {
          window.navigator.serviceWorker
            .register("/sw.js", {
              scope: "/"
            })
        }
      });
    </script>
</body>
</html>

